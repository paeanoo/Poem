# AI诗词助手配置指南

## 🔍 问题诊断

AI诗词助手出现"连接错误: AI服务暂时不可用"的问题，主要原因如下：

### 1. **n8n工作流服务不可用**
- 默认的n8n服务地址可能已停止服务
- 网络连接问题导致无法访问外部API
- 缺少必要的环境变量配置

### 2. **环境配置缺失**
- 项目缺少 `.env` 文件
- 未配置 `VITE_N8N_WEBHOOK_URL` 环境变量
- 缺少API密钥配置

## 🛠️ 解决方案

### 方案一：使用本地AI回复（推荐）

项目已集成本地AI回复功能，无需外部服务即可正常工作：

1. **自动备用机制**：当n8n服务不可用时，自动切换到本地AI回复
2. **智能匹配**：根据用户问题匹配相应的诗词知识
3. **离线工作**：不依赖网络连接，确保功能可用

### 方案二：配置自己的n8n服务

如果需要使用真实的AI服务，请按以下步骤配置：

#### 1. 创建环境配置文件

复制 `env.example` 文件为 `.env`：

```bash
cp env.example .env
```

#### 2. 配置n8n工作流

编辑 `.env` 文件，设置您的n8n服务地址：

```env
# n8n工作流配置
VITE_N8N_WEBHOOK_URL=https://your-n8n-instance.com/webhook/poetry-analysis
VITE_N8N_API_KEY=your-api-key-here
```

#### 3. 部署n8n工作流

参考 `N8N_WORKFLOW_SETUP.md` 文档配置n8n工作流。

## 🎯 当前功能状态

### ✅ 已实现功能

1. **本地AI回复系统**
   - 李白、杜甫、苏轼等诗人介绍
   - 经典诗词推荐
   - 诗词创作技巧指导
   - 意境解析说明

2. **智能匹配算法**
   - 精确匹配用户问题
   - 关键词模糊匹配
   - 默认回复机制

3. **错误处理机制**
   - 自动降级到本地回复
   - 详细的错误日志
   - 用户友好的错误提示

### 🔧 技术实现

```typescript
// 本地AI回复数据
const localAIResponses: Record<string, string> = {
  '李白介绍': '详细的李白介绍内容...',
  '推荐经典诗词': '诗词推荐内容...',
  // 更多回复...
};

// 智能匹配函数
function getLocalAIResponse(message: string): string {
  // 精确匹配
  if (localAIResponses[message]) {
    return localAIResponses[message];
  }
  
  // 关键词匹配
  for (const [key, response] of Object.entries(localAIResponses)) {
    if (lowerMessage.includes(key.toLowerCase())) {
      return response;
    }
  }
  
  // 默认回复
  return '感谢您的提问！我是AI诗词助手...';
}
```

## 🚀 使用说明

### 1. 启动项目

```bash
npm run dev
```

### 2. 测试AI助手

1. 点击右下角的AI助手按钮
2. 尝试以下问题：
   - "李白介绍"
   - "推荐经典诗词"
   - "诗词创作技巧"
   - "意境解析"

### 3. 查看日志

打开浏览器开发者工具，查看控制台日志：
- `🎯 使用本地AI回复` - 表示使用本地回复
- `📤 发送HTTP请求到` - 表示尝试n8n服务
- `❌ n8n请求失败` - 表示n8n服务不可用

## 📊 性能优化

### 1. 响应速度
- 本地AI回复：< 100ms
- n8n服务请求：1-3秒
- 自动降级机制：确保快速响应

### 2. 可靠性
- 双重保障：本地 + 远程服务
- 错误恢复：自动重试机制
- 离线工作：无需网络连接

## 🔮 未来扩展

### 1. 增强本地AI
- 添加更多诗人介绍
- 扩展诗词数据库
- 增加创作指导内容

### 2. 集成真实AI
- 配置OpenAI API
- 集成Claude API
- 添加自定义模型

### 3. 功能增强
- 语音交互
- 图片识别
- 多语言支持

## 🆘 故障排除

### 问题1：仍然显示连接错误
**解决方案**：
1. 清除浏览器缓存
2. 重启开发服务器
3. 检查控制台错误信息

### 问题2：本地AI回复不准确
**解决方案**：
1. 更新 `localAIResponses` 数据
2. 优化匹配算法
3. 添加更多关键词

### 问题3：n8n服务配置问题
**解决方案**：
1. 检查环境变量配置
2. 验证n8n工作流状态
3. 测试网络连接

## 📞 技术支持

如果遇到问题，请：
1. 查看浏览器控制台错误
2. 检查网络连接状态
3. 验证环境配置
4. 参考相关文档

---

*让AI技术为诗词文化传承注入新的活力* ✨

